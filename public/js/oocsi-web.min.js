var OOCSI=(function(){var e="ws://localhost/ws";var g;var p={};var b={};var l={};var t;var v=false;var w=d;function r(){w("CONNECTING to "+e);t=new WebSocket(e);t.onopen=function(x){h(x)};t.onclose=function(x){f(x)};t.onmessage=function(x){s(x)};t.onerror=function(x){i(x)}}function h(x){if(t.readyState==WebSocket.OPEN){k(g);v=true}w("CONNECTED")}function f(x){w("DISCONNECTED");v=false}function s(x){t.send(".");if(x.data!="ping"){try{var y=JSON.parse(x.data);if(y.data.hasOwnProperty("_MESSAGE_ID")&&l.hasOwnProperty(y.data._MESSAGE_ID)){var z=l[y.data._MESSAGE_ID];if((+new Date)<z.expiration){delete y.data._MESSAGE_ID;z.fn(y.data)}delete l[y.data._MESSAGE_ID]}else{if(p[y.recipient]!==undefined){p[y.recipient](y)}else{w("no handler for event: "+x.data)}}}catch(y){w("ERROR: parse exception for event data "+x.data)}w("RESPONSE: "+x.data)}}function i(x){w("ERROR: "+x.data)}function n(x){if(!t||t.readyState==WebSocket.CONNECTING){setTimeout(function(){n(x)},200)}else{x()}}function o(){t&&t.close()}function k(x){if(t&&t.send(x)){w("SENT: "+x)}}function d(x){}function c(x,y){v&&k("sendjson "+x+" "+JSON.stringify(y))}function m(z,B,A,y){if(v){var x=q();l[x]={expiration:(+new Date)+A,fn:y};B._MESSAGE_ID=x;B._MESSAGE_HANDLE=z;k("sendjson "+z+" "+JSON.stringify(B))}}function a(y,x){if(v){b[y]={fn:x};j(y,function(A){var z={_MESSAGE_ID:A.data._MESSAGE_ID};x(A.data,z);c(A.sender,z)})}}function j(y,x){if(v){k("subscribe "+y);p[y]=x}}function u(x){if(v){k("unsubscribe "+x);p[x]=function(){}}}function q(){function x(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return x()+x()+"-"+x()+"-"+x()+"-"+x()+"-"+x()+x()+x()}return{connect:function(z,y,x){e=z;g=y&&y.length>0?y:"webclient_"+ +(new Date());p[y]=x;r()},send:function(y,x){n(function(){c(y,x)})},call:function(y,A,z,x){n(function(){m(y,A,z,x)})},register:function(y,x){n(function(){a(y,x)})},subscribe:function(y,x){n(function(){j(y,x)})},unsubscribe:function(x){n(function(){u(x)})},variable:function(B,y){var A=[];var C;function z(D){A.forEach(function(E){E(D)})}function x(D){if(arguments.length&&D!==C){C=D;z(D);c(B,{name:C})}return C}x.subscribe=function(D){A.push(D)};this.subscribe(B,function(D){if(D.data.hasOwnProperty(y)){x(D.data[y])}});return x},isConnected:function(){return v},close:function(){n(function(){o()})},handlers:function(){return p},logger:function(x){w=x}}})();
