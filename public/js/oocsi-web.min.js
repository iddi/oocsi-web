var OOCSI=function(){function z(){h("CONNECTING to "+w);l=new WebSocket(w);l.onopen=C;l.onclose=D;l.onmessage=E;l.onerror=F}function C(a){l.readyState===WebSocket.OPEN&&u(q);h("CONNECTED")}function D(a){h("DISCONNECTED")}function E(a){if("ping"!==a.data){try{var c=JSON.parse(a.data);if(c.data.hasOwnProperty("_MESSAGE_ID")&&v.hasOwnProperty(c.data._MESSAGE_ID)){var e=v[c.data._MESSAGE_ID];+new Date<e.expiration&&(delete c.data._MESSAGE_ID,e.fn(c.data));delete v[c.data._MESSAGE_ID]}else void 0!==p[c.recipient]?
p[c.recipient].forEach(d=>{d(c)}):h("no handler for event: "+a.data)}catch(d){h("ERROR: parse exception for event data "+a.data)}h("RESPONSE: "+a.data)}else 0<a.data.length&&l.send(".")}function F(a){A();h("ERROR: "+a)}function r(a){l&&l.readyState!==WebSocket.CONNECTING?a():setTimeout(function(){r(a)},200)}function u(a){l&&l.send(a)&&h("SENT: "+a)}function t(){return l.readyState===WebSocket.OPEN}function x(a,c){t()&&u("sendjson "+a+" "+JSON.stringify(c))}function G(a,c){t()&&B(a,function(e){var d=
{_MESSAGE_ID:e.data._MESSAGE_ID};c(e.data,d);x(e.sender,d)})}function B(a,c){t()&&(u("subscribe "+a),void 0===p[a]&&(p[a]=[]),p[a].push(c))}function H(){t()||l.readyState===WebSocket.CONNECTING||(h("RECONNECTING"),z(),r(function(){for(ch in p)u("subscribe "+ch)}))}function I(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}var w="ws://localhost/ws",q,p={},v={},l,h=function(a){},A=function(){};return{connect:function(a,
c,e){w=a;q=c&&0<c.length?c:"webclient_####";q=q.replace(/#/g,()=>Math.floor(10*Math.random()));p[q]=[e];z();setInterval(H,1E3)},send:function(a,c){r(function(){x(a,c)})},call:function(a,c,e,d){r(function(){if(t()){var b=I();v[b]={expiration:+new Date+e,fn:d};c._MESSAGE_ID=b;c._MESSAGE_HANDLE=a;u("sendjson "+a+" "+JSON.stringify(c))}})},register:function(a,c){r(function(){G(a,c)})},subscribe:function(a,c){r(function(){B(a,c)})},unsubscribe:function(a){r(function(){t()&&(u("unsubscribe "+
a),p[a]=[])})},variable:function(a,c,e=500){function d(f){k.forEach(function(m){m(f)})}function b(f,m=!0){if(0===arguments.length)return g;if(!(n+e>Date.now())){n=Date.now();var y=f!==g;g=f;d(g);y&&m&&(m={},m[c]=g,x(a,m));return g}}var k=[],g,n=0;b.subscribe=function(f){k.push(f)};this.subscribe(a,function(f){f.data.hasOwnProperty(c)&&b(f.data[c],!1)});return b},isConnected:function(){return t()},handle:function(){return q},close:function(){r(function(){l&&l.close()})},handlers:function(){return p},
logger:function(a){h=a},error:function(a){A=a},heyOOCSI:function(a){var c=a||q,e={};e[c]={};e[c].properties={device_id:q};e[c].location={};e[c].components={};var d=e[c].components;h(`Added heyOOCSI device ${c}`);return{add_property:function(b,k){e[c].properties[b]=k},add_location:function(b,k,g){e[c].properties[b]=[k,g]},add_sensor_brick:function(b,k,g,n,f,m){d[b]={};d[b].channel_name=k;d[b].type="sensor";d[b].sensor_type=g;d[b].unit=n;d[b].value=f;d[b].icon=m;h(`Added ${b} to the components list for device ${c}.`)},
add_number_brick:function(b,k,g,n,f,m){d[b]={};d[b].channel_name=k;d[b].type="number";d[b].min_max=g;d[b].unit=n;d[b].value=f;d[b].icon=m;h(`Added ${b} to the components list for device ${c}.`)},add_binary_sensor_brick:function(b,k,g,n,f){d[b]={};d[b].channel_name=k;d[b].type="binary_sensor";d[b].sensor_type=g;d[b].state=n;d[b].icon=f;h(`Added ${b} to the components list for device ${c}.`)},add_switch_brick:function(b,k,g,n,f){d[b]={};d[b].channel_name=k;d[b].type="switch";d[b].sensor_type=g;d[b].state=
n;d[b].icon=f;h(`Added ${b} to the components list for device ${c}.`)},add_light_brick:function(b,k,g,n,f,m,y,J){d[b]={};d[b].channel_name=k;d[b].type="light";d[b].ledType=g;d[b].spectrum=n;d[b].min_max=f;d[b].state=m;d[b].brightness=y;d[b].icon=J;h(`Added ${b} to the components list for device ${c}.`)},submit:function(){OOCSI.send("heyOOCSI!",e)},sayHi:function(){OOCSI.send("heyOOCSI!",e)}}}}}();
