var OOCSI=(function(){var e="ws://localhost/ws";var g;var p={};var b={};var l={};var v;var x=false;var y=d;var r=s;function t(){y("CONNECTING to "+e);v=new WebSocket(e);v.onopen=function(z){h(z)};v.onclose=function(z){f(z)};v.onmessage=function(z){u(z)};v.onerror=function(z){i(z)}}function h(z){if(v.readyState==WebSocket.OPEN){k(g);x=true}y("CONNECTED")}function f(z){y("DISCONNECTED");x=false}function u(z){v.send(".");if(z.data!="ping"){try{var A=JSON.parse(z.data);if(A.data.hasOwnProperty("_MESSAGE_ID")&&l.hasOwnProperty(A.data._MESSAGE_ID)){var B=l[A.data._MESSAGE_ID];if((+new Date)<B.expiration){delete A.data._MESSAGE_ID;B.fn(A.data)}delete l[A.data._MESSAGE_ID]}else{if(p[A.recipient]!==undefined){p[A.recipient](A)}else{y("no handler for event: "+z.data)}}}catch(A){y("ERROR: parse exception for event data "+z.data)}y("RESPONSE: "+z.data)}}function i(z){r();y("ERROR: "+z)}function n(z){if(!v||v.readyState==WebSocket.CONNECTING){setTimeout(function(){n(z)},200)}else{z()}}function k(z){if(v&&v.send(z)){y("SENT: "+z)}}function o(){v&&v.close()}function d(z){}function s(){}function c(z,A){x&&k("sendjson "+z+" "+JSON.stringify(A))}function m(B,D,C,A){if(x){var z=q();l[z]={expiration:(+new Date)+C,fn:A};D._MESSAGE_ID=z;D._MESSAGE_HANDLE=B;k("sendjson "+B+" "+JSON.stringify(D))}}function a(A,z){if(x){b[A]={fn:z};j(A,function(C){var B={_MESSAGE_ID:C.data._MESSAGE_ID};z(C.data,B);c(C.sender,B)})}}function j(A,z){if(x){k("subscribe "+A);p[A]=z}}function w(z){if(x){k("unsubscribe "+z);p[z]=function(){}}}function q(){function z(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return z()+z()+"-"+z()+"-"+z()+"-"+z()+"-"+z()+z()+z()}return{connect:function(B,A,z){e=B;g=A&&A.length>0?A:"webclient_"+ +(new Date());p[A]=z;t()},send:function(A,z){n(function(){c(A,z)})},call:function(A,C,B,z){n(function(){m(A,C,B,z)})},register:function(A,z){n(function(){a(A,z)})},subscribe:function(A,z){n(function(){j(A,z)})},unsubscribe:function(z){n(function(){w(z)})},variable:function(D,A){var C=[];var E;function B(F){C.forEach(function(G){G(F)})}function z(F){if(arguments.length&&F!==E){E=F;B(F);c(D,{name:E})}return E}z.subscribe=function(F){C.push(F)};this.subscribe(D,function(F){if(F.data.hasOwnProperty(A)){z(F.data[A])}});return z},isConnected:function(){return x},close:function(){n(function(){o()})},handlers:function(){return p},logger:function(z){y=z},error:function(z){r=z}}})();
